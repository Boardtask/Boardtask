{% extends "base.html" %}

{% block title %}{{ project.title }} Â· {{ app_name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-8 px-4">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">{{ project.title }}</h1>
        <a href="/app/projects" class="text-blue-600 hover:text-blue-500">Back to projects</a>
    </div>

    <div x-data="graph('{{ project.id }}')"
        class="bg-gray-50 border border-gray-200 rounded-lg overflow-hidden shadow-sm">
        <!-- Controls -->
        <div class="p-4 bg-white border-b border-gray-200 flex flex-wrap gap-3">
            <button @click="addNode()"
                class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition font-medium text-sm shadow-sm">
                Add Standalone Node
            </button>

            <div class="h-8 w-px bg-gray-200 mx-1"></div>

            <button @click="addChildNode()" :disabled="selectedNodeIds.length === 0"
                :class="selectedNodeIds.length > 0 ? 'bg-white border-indigo-200 text-indigo-700 hover:bg-indigo-50 hover:border-indigo-300' : 'bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed'"
                class="border px-4 py-2 rounded-md transition font-medium text-sm shadow-sm">
                Add Child Node
            </button>
            <button @click="addParentNode()" :disabled="selectedNodeIds.length === 0"
                :class="selectedNodeIds.length > 0 ? 'bg-white border-indigo-200 text-indigo-700 hover:bg-indigo-50 hover:border-indigo-300' : 'bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed'"
                class="border px-4 py-2 rounded-md transition font-medium text-sm shadow-sm">
                Add Parent Node
            </button>
            <button @click="connectNodes()" :disabled="selectedNodeIds.length !== 2"
                :class="selectedNodeIds.length === 2 ? 'bg-indigo-50 border-indigo-300 text-indigo-700 hover:bg-indigo-100 hover:border-indigo-400' : 'bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed'"
                class="border px-4 py-2 rounded-md transition font-medium text-sm shadow-sm">
                Connect Selected (2)
            </button>
            <button @click="disconnectNodes()" :disabled="selectedNodeIds.length !== 2"
                :class="selectedNodeIds.length === 2 ? 'bg-white border-red-200 text-red-600 hover:bg-red-50 hover:border-red-300' : 'bg-gray-50 border-gray-200 text-gray-400 cursor-not-allowed'"
                class="border px-4 py-2 rounded-md transition font-medium text-sm shadow-sm">
                Disconnect Selected (2)
            </button>

            <div class="h-8 w-px bg-gray-200 mx-1"></div>

            <button @click="toggleDirection()"
                class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 transition font-medium text-sm shadow-sm flex items-center gap-2">
                <span class="material-symbols-outlined text-sm"
                    x-text="layoutDirection === 'TB' ? 'south' : 'east'"></span>
                <span x-text="layoutDirection === 'TB' ? 'Top Down' : 'Left to Right'"></span>
            </button>

            <div class="h-8 w-px bg-gray-200 mx-1"></div>

            <button @click="removeNode()"
                class="bg-white border border-red-200 text-red-600 px-4 py-2 rounded-md hover:bg-red-50 hover:border-red-300 transition font-medium text-sm shadow-sm">
                Remove Selected/Last
            </button>
            <button @click="runLayout()"
                class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 transition font-medium text-sm shadow-sm">
                Redraw
            </button>
        </div>

        <!-- Cytoscape Container -->
        <div x-ref="canvas" style="height: 500px; width: 100%;"></div>
    </div>

    <p class="text-xs text-gray-400 mt-4">Project ID: {{ project.id }}</p>
</div>
{% endblock %}